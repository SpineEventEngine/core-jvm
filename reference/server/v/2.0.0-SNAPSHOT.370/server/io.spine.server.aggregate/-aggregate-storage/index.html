<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>AggregateStorage</title>
    <link href="../../../images/logo-icon.svg" rel="icon" type="image/svg">
        <script>var pathToRoot = "../../../";</script>
    <script>document.documentElement.classList.replace("no-js", "js");</script>
    <script>const storage = localStorage.getItem("dokka-dark-mode")
      if (storage == null) {
        const osDarkSchemePreferred = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
        if (osDarkSchemePreferred === true) {
          document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
      } else {
        const savedDarkMode = JSON.parse(storage)
        if (savedDarkMode === true) {
          document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
      }
    </script>
<script type="text/javascript" src="https://unpkg.com/kotlin-playground@1/dist/playground.min.js" async="async"></script>
<script type="text/javascript" src="../../../scripts/sourceset_dependencies.js" async="async"></script>
<link href="../../../styles/style.css" rel="Stylesheet">
<link href="../../../styles/main.css" rel="Stylesheet">
<link href="../../../styles/prism.css" rel="Stylesheet">
<link href="../../../styles/logo-styles.css" rel="Stylesheet">
<link href="../../../ui-kit/ui-kit.min.css" rel="Stylesheet">
<script type="text/javascript" src="../../../scripts/safe-local-storage_blocking.js"></script>
<script type="text/javascript" src="../../../scripts/navigation-loader.js" async="async"></script>
<script type="text/javascript" src="../../../scripts/platform-content-handler.js" async="async"></script>
<script type="text/javascript" src="../../../scripts/main.js" defer="defer"></script>
<script type="text/javascript" src="../../../scripts/prism.js" async="async"></script>
<script type="text/javascript" src="../../../ui-kit/ui-kit.min.js" defer="defer"></script>
<link href="../../../images/logo-icon.svg">
<link href="../../../styles/custom-styles.css" rel="Stylesheet">
</head>
<body>
<div class="root">
    <header class="navigation theme-dark" id="navigation-wrapper" role="banner">
            <a class="library-name--link" href="../../../index.html" tabindex="1">
                    server
            </a>
        <button class="navigation-controls--btn navigation-controls--btn_toc ui-kit_mobile-only" id="toc-toggle"
                type="button">Toggle table of contents
        </button>
        <div class="navigation-controls--break ui-kit_mobile-only"></div>
        <div class="library-version" id="library-version">
2.0.0-SNAPSHOT.370        </div>
        <div class="navigation-controls">
        <ul class="filter-section filter-section_loading" id="filter-section" aria-label="Target filter">
                <button class="platform-tag platform-selector jvm-like" data-active="" aria-pressed="true"
                        data-filter=":server/main">jvm</button>
            <div class="dropdown filter-section--dropdown" data-role="dropdown" id="filter-section-dropdown">
                <button class="button button_dropdown filter-section--dropdown-toggle" role="combobox"
                        data-role="dropdown-toggle"
                        aria-controls="platform-tags-listbox"
                        aria-haspopup="listbox"
                        aria-expanded="false"
                        aria-label="Toggle source sets"
                ></button>
                <ul role="listbox" id="platform-tags-listbox" class="dropdown--list" data-role="dropdown-listbox" aria-label="Target filter">
                    <div class="dropdown--header"><span>Target filter</span>
                        <button class="button" data-role="dropdown-toggle" aria-label="Close target filter">
                            <i class="ui-kit-icon ui-kit-icon_cross"></i>
                        </button>
                    </div>
                        <li role="option" class="dropdown--option platform-selector-option jvm-like" tabindex="0">
                            <label class="checkbox">
                                <input type="checkbox" class="checkbox--input" id=":server/main"
                                       data-filter=":server/main"/>
                                <span class="checkbox--icon"></span>
                                jvm
                            </label>
                        </li>
                </ul>
                <div class="dropdown--overlay"></div>
            </div>
        </ul>
            <button class="navigation-controls--btn navigation-controls--btn_theme" id="theme-toggle-button"
                    type="button">Switch theme
            </button>
            <div class="navigation-controls--btn navigation-controls--btn_search" id="searchBar" role="button">Search in
                API
            </div>
        </div>
    </header>
    <div id="container">
        <nav id="leftColumn" class="sidebar" data-item-type="SECTION" data-item-config='{"defaultSize": 280, "minSize": 200, "maxSize": 400}'>
            <a class="toc--skip-link" href="#main">Skip to content</a>
            <div class="dropdown theme-dark_mobile" data-role="dropdown" id="toc-dropdown">
                <ul role="listbox" id="toc-listbox" class="dropdown--list dropdown--list_toc-list"
                    data-role="dropdown-listbox" aria-label="Table of contents">
                    <div class="dropdown--header">
                            <span>
                                    server
                            </span>
                        <button class="button" data-role="dropdown-toggle" aria-label="Close table of contents">
                            <i class="ui-kit-icon ui-kit-icon_cross"></i>
                        </button>
                    </div>
                    <div class="sidebar--inner" id="sideMenu"></div>
                </ul>
                <div class="dropdown--overlay"></div>
            </div>
        </nav>
        <div id="resizer" class="resizer" data-item-type="BAR"></div>
        <div id="main" data-item-type="SECTION" role="main">
<div class="main-content" data-page-type="classlike" id="content" pageIds="server::io.spine.server.aggregate/AggregateStorage///PointingToDeclaration//332232451">
  <div class="breadcrumbs"><a href="../../../index.html">server</a><span class="delimiter">/</span><a href="../index.html">io.spine.server.aggregate</a><span class="delimiter">/</span><span class="current">AggregateStorage</span></div>
  <div class="cover ">
    <h1 class="cover"><span>Aggregate</span><wbr></wbr><span><span>Storage</span></span></h1>
    <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":server/main"><div class="symbol monospace"><div class="block"><div class="block"><span class="token annotation builtin">@</span><span data-unresolved-link="io.spine.annotation/SPI///PointingToDeclaration/"><span class="token annotation builtin">SPI</span></span></div></div><span class="token keyword">open </span><span class="token keyword">class </span><a href="index.html">AggregateStorage</a><span class="token operator">&lt;</span><a href="index.html">I</a><span class="token punctuation">, </span><a href="index.html">S</a><span class="token operator"> : </span><span data-unresolved-link="io.spine.base/AggregateState///PointingToDeclaration/">AggregateState</span><span class="token operator">&lt;</span><a href="index.html">I</a><span class="token operator">&gt;</span><span class="token operator">?</span><span class="token operator">&gt;</span> : <a href="../../io.spine.server.storage/-abstract-storage/index.html">AbstractStorage</a><span class="token operator">&lt;</span><a href="index.html">I</a><span class="token punctuation">, </span><a href="../-aggregate-history/index.html">AggregateHistory</a><span class="token operator">&gt; </span></div><p class="paragraph">A storage of aggregate events, snapshots and the most recent aggregate states. </p><p class="paragraph">The instances of this type solve two problems. </p><ol><li>efficient loading of an Aggregate instance from its events; </li><li>storing the latest state of an Aggregate along with its lifecycle flags to allow its further querying. </li></ol><h2 class="">Storing Aggregate events</h2><p class="paragraph">Each Aggregate is an event-sourced Entity. To load an Aggregate instance, one plays all the events emitted by it, eventually obtaining the last known state. While the Event Store of a Bounded Context, to which some Aggregate belongs, stores all domain events, using it for the sake of loading an Aggregate is inefficient in most cases. An overwhelming number of the domain events emitted in a Bounded Context and the restrictions applied by an underlying storage tools make searching for the events of a particular Aggregate a difficult task, given that the events are constantly being appended to the respective Event Store. </p><p class="paragraph">This storage duplicates a portion of events emitted by the Aggregates of a certain type. It dramatically narrows down the number of storage records to traverse when loading. Additionally, this storage is responsible for storing the intermediate snapshots of Aggregate states, incorporating them into an optimized loading routines. The history of an Aggregate is being read from the most recent event till its most recent snapshot, which reduces the I/O between the underlying storage and application even more and enhances the overall system performance. </p><p class="paragraph">In order to store events and snapshots, an intermediate <a href="../-aggregate-event-storage/index.html">AggregateEventStorage</a> is created. It persists data as Protobuf message records in its pre-configured <a href="../../io.spine.server.storage/-record-storage/index.html">RecordStorage</a>. </p><h2 class="">Storing and querying the latest Aggregate states</h2><p class="paragraph">End-users of the framework are able to set the visibility level for each Aggregate state by using an <span data-unresolved-link="io.spine.server.entity/EntityVisibility///PointingToDeclaration/">(entity).visibility</span> option in the Protobuf message corresponding to the Aggregate state. For those Aggregates which are visible, the framework routines <span data-unresolved-link="io.spine.server.aggregate/AggregateStorage/enableStateQuerying/#/PointingToDeclaration/">enable this storage</span> to persist the latest states of Aggregates and allow their further <a href="read-states.html">querying</a>. To some extent, it makes this storage a part of an application's read-side. </p><p class="paragraph">Similar to storages of other Entity types, <code class="lang-kotlin">AggregateStorage</code> supports querying the Aggregate states by the values of their declared entity columns. See <code class="lang-kotlin">io.spine.query</code> package docs for more details on the query language. </p><p class="paragraph">However, even if the Aggregate visibility is set to <span data-unresolved-link="io.spine.option/EntityOption.Visibility.NONE///PointingToDeclaration/{&amp;quot;org.jetbrains.dokka.links.EnumEntryDRIExtra&amp;quot;:{&amp;quot;key&amp;quot;:&amp;quot;org.jetbrains.dokka.links.EnumEntryDRIExtra&amp;quot;}}">NONE</span>, the storage still persists the essential bits of Aggregate as-an-Entity. Namely, its identifier, its lifecycle flags and version. Such a behavior allows to speed up the execution of calls such as <a href="--index--.html">obtaining an index</a> of Aggregate identifiers, which otherwise would involve major scans of event storage, with <code class="lang-kotlin">DISTINCT</code> group operation applied. </p><p class="paragraph">As long as the Aggregate states are no different in their persistence from other Entities, the <code class="lang-kotlin">AggregateStorage</code> uses an intermediate <a href="../../io.spine.server.entity.storage/-entity-record-storage/index.html">EntityRecordStorage</a> by delegating all state-related operations to it.</p><h4 class="tableheader">Parameters</h4><div class="table"><div class="table-row table-row_content" data-filterable-current=":server/main" data-filterable-set=":server/main"><div class="main-subrow keyValue "><div class=""><span class="inline-flex"><div><u><span><span>&lt;I&gt;</span></span></u></div></span></div><div><div class="title"><p class="paragraph">the type of IDs of aggregates served by this storage</p></div></div></div></div><div class="table-row table-row_content" data-filterable-current=":server/main" data-filterable-set=":server/main"><div class="main-subrow keyValue "><div class=""><span class="inline-flex"><div><u><span><span>&lt;S&gt;</span></span></u></div></span></div><div><div class="title"><p class="paragraph">the type of states of aggregates served by this storage</p></div></div></div></div></div></div></div>
  </div>
  <div class="tabbedcontent">
    <div class="tabs-section" tabs-section="tabs-section"><button class="section-tab" data-active="" data-togglable="CONSTRUCTOR,TYPE,PROPERTY,FUNCTION">Members</button></div>
    <div class="tabs-section-body">
      <div data-togglable="CONSTRUCTOR">
        <h2 class="tableheader">Constructors</h2>
        <div class="table"><a data-name="-1841308758%2FConstructors%2F332232451" anchor-label="AggregateStorage" id="-1841308758%2FConstructors%2F332232451" data-filterable-set=":server/main"></a>
          <div class="table-row table-row_content" data-togglable="CONSTRUCTOR" data-filterable-current=":server/main" data-filterable-set=":server/main">
            <div class="main-subrow keyValue ">
              <div class=""><span class="inline-flex">
                  <div><a href="-aggregate-storage.html"><span>Aggregate</span><wbr></wbr><span><span>Storage</span></span></a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-1841308758%2FConstructors%2F332232451"></span>
                    <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                  </span></span></div>
              <div>
                <div class="title">
                  <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":server/main"><div class="symbol monospace"><span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">context<span class="token operator">: </span><a href="../../io.spine.server/-context-spec/index.html">ContextSpec</a><span class="token punctuation">, </span></span><span class="parameter ">aggregateClass<span class="token operator">: </span><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/Class.html">Class</a><span class="token operator">&lt;</span><span class="token keyword">out </span><a href="../-aggregate/index.html">Aggregate</a><span class="token operator">&lt;</span><a href="index.html">I</a><span class="token punctuation">, </span><a href="index.html">S</a><span class="token punctuation">, </span><span class="token keyword">out </span><a href="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin/-any/index.html">Any</a><span class="token operator">&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">, </span></span><span class="parameter ">factory<span class="token operator">: </span><a href="../../io.spine.server.storage/-storage-factory/index.html">StorageFactory</a></span></span><span class="token punctuation">)</span></div><div class="brief ">Creates an instance of the storage for a certain aggregate class registered in a specific context.</div><div class="symbol monospace"><span class="token keyword">protected </span><span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">delegate<span class="token operator">: </span><a href="index.html">AggregateStorage</a><span class="token operator">&lt;</span><a href="index.html">I</a><span class="token punctuation">, </span><a href="index.html">S</a><span class="token operator">&gt;</span></span></span><span class="token punctuation">)</span></div></div></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div data-togglable="FUNCTION">
        <h2 class="tableheader">Functions</h2>
        <div class="table"><a data-name="-804981180%2FFunctions%2F332232451" anchor-label="doTruncate" id="-804981180%2FFunctions%2F332232451" data-filterable-set=":server/main"></a>
          <div class="table-row table-row_content" data-filterable-current=":server/main" data-filterable-set=":server/main">
            <div class="main-subrow keyValue ">
              <div class=""><span class="inline-flex">
                  <div><a href="do-truncate.html"><span>do</span><wbr></wbr><span><span>Truncate</span></span></a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-804981180%2FFunctions%2F332232451"></span>
                    <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                  </span></span></div>
              <div>
                <div class="title">
                  <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":server/main"><div class="symbol monospace"><span class="token keyword">protected </span><span class="token keyword">open </span><span class="token keyword">fun </span><a href="do-truncate.html"><span class="token function">doTruncate</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">snapshotIndex<span class="token operator">: </span><a href="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin/-int/index.html">Int</a></span></span><span class="token punctuation">)</span></div><div class="brief ">Drops all records which occur before the N-th snapshot for each entity.</div><div class="symbol monospace"><span class="token keyword">protected </span><span class="token keyword">open </span><span class="token keyword">fun </span><a href="do-truncate.html"><span class="token function">doTruncate</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">snapshotIndex<span class="token operator">: </span><a href="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin/-int/index.html">Int</a><span class="token punctuation">, </span></span><span class="parameter ">date<span class="token operator">: </span><span data-unresolved-link="com.google.protobuf/Timestamp///PointingToDeclaration/">Timestamp</span></span></span><span class="token punctuation">)</span></div><div class="brief ">Drops all records older than <code class="lang-kotlin">date</code> but not newer than the N-th snapshot for each entity.</div></div></div>
                </div>
              </div>
            </div>
          </div>
<a data-name="1939003971%2FFunctions%2F332232451" anchor-label="historyBackward" id="1939003971%2FFunctions%2F332232451" data-filterable-set=":server/main"></a>
          <div class="table-row table-row_content" data-filterable-current=":server/main" data-filterable-set=":server/main">
            <div class="main-subrow keyValue ">
              <div class=""><span class="inline-flex">
                  <div><a href="history-backward.html"><span>history</span><wbr></wbr><span><span>Backward</span></span></a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="1939003971%2FFunctions%2F332232451"></span>
                    <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                  </span></span></div>
              <div>
                <div class="title">
                  <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":server/main"><div class="symbol monospace"><span class="token keyword">protected </span><span class="token keyword">open </span><span class="token keyword">fun </span><a href="history-backward.html"><span class="token function">historyBackward</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">id<span class="token operator">: </span><a href="index.html">I</a><span class="token punctuation">, </span></span><span class="parameter ">batchSize<span class="token operator">: </span><a href="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin/-int/index.html">Int</a><span class="token punctuation">, </span></span><span class="parameter "><span><span class="token annotation builtin">@</span><span data-unresolved-link="org.jspecify.annotations/Nullable///PointingToDeclaration/"><span class="token annotation builtin">Nullable</span></span> </span>startingFrom<span class="token operator">: </span><span><span class="token annotation builtin">@</span><span data-unresolved-link="org.jspecify.annotations/Nullable///PointingToDeclaration/"><span class="token annotation builtin">Nullable</span></span> </span><span data-unresolved-link="io.spine.core/Version///PointingToDeclaration/">Version</span></span></span><span class="token punctuation">)</span><span class="token operator">: </span><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Iterator.html">Iterator</a><span class="token operator">&lt;</span><a href="../-aggregate-event-record/index.html">AggregateEventRecord</a><span class="token operator">&gt;</span></div><div class="brief ">Acts similar to <span data-unresolved-link="io.spine.server.aggregate/AggregateStorage/historyBackward/#I#int/PointingToDeclaration/">historyBackward(id, batchSize)</span>, but also allows to set the Aggregate version to start the reading from.</div></div></div>
                </div>
              </div>
            </div>
          </div>
<a data-name="417941110%2FFunctions%2F332232451" anchor-label="index" id="417941110%2FFunctions%2F332232451" data-filterable-set=":server/main"></a>
          <div class="table-row table-row_content" data-filterable-current=":server/main" data-filterable-set=":server/main">
            <div class="main-subrow keyValue ">
              <div class=""><span class="inline-flex">
                  <div><a href="--index--.html"><span><span>index</span></span></a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="417941110%2FFunctions%2F332232451"></span>
                    <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                  </span></span></div>
              <div>
                <div class="title">
                  <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":server/main"><div class="symbol monospace"><span class="token keyword">open </span><span class="token keyword">fun </span><a href="--index--.html"><span class="token function">index</span></a><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">: </span><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Iterator.html">Iterator</a><span class="token operator">&lt;</span><a href="index.html">I</a><span class="token operator">&gt;</span></div><div class="brief ">Returns an iterator over identifiers of Aggregates served by this storage.</div></div></div>
                </div>
              </div>
            </div>
          </div>
<a data-name="2011567320%2FFunctions%2F332232451" anchor-label="read" id="2011567320%2FFunctions%2F332232451" data-filterable-set=":server/main"></a>
          <div class="table-row table-row_content" data-filterable-current=":server/main" data-filterable-set=":server/main">
            <div class="main-subrow keyValue ">
              <div class=""><span class="inline-flex">
                  <div><a href="read.html"><span><span>read</span></span></a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="2011567320%2FFunctions%2F332232451"></span>
                    <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                  </span></span></div>
              <div>
                <div class="title">
                  <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":server/main"><div class="symbol monospace"><span class="token keyword">open </span><span class="token keyword">fun </span><a href="read.html"><span class="token function">read</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">id<span class="token operator">: </span><a href="index.html">I</a></span></span><span class="token punctuation">)</span><span class="token operator">: </span><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Optional.html">Optional</a><span class="token operator">&lt;</span><a href="../-aggregate-history/index.html">AggregateHistory</a><span class="token operator">&gt;</span></div><div class="brief ">Reads a record from the storage by the specified record identifier.</div><div class="symbol monospace"><span class="token keyword">open </span><span class="token keyword">fun </span><a href="read.html"><span class="token function">read</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">id<span class="token operator">: </span><a href="index.html">I</a><span class="token punctuation">, </span></span><span class="parameter ">batchSize<span class="token operator">: </span><a href="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin/-int/index.html">Int</a></span></span><span class="token punctuation">)</span><span class="token operator">: </span><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Optional.html">Optional</a><span class="token operator">&lt;</span><a href="../-aggregate-history/index.html">AggregateHistory</a><span class="token operator">&gt;</span></div><div class="brief ">Forms and returns an <a href="../-aggregate-history/index.html">AggregateHistory</a> based on the <span data-unresolved-link="io.spine.server.aggregate/AggregateStorage/historyBackward/#I#int/PointingToDeclaration/">historyBackward</span> aggregate history}.</div></div></div>
                </div>
              </div>
            </div>
          </div>
<a data-name="-2102066566%2FFunctions%2F332232451" anchor-label="readStates" id="-2102066566%2FFunctions%2F332232451" data-filterable-set=":server/main"></a>
          <div class="table-row table-row_content" data-filterable-current=":server/main" data-filterable-set=":server/main">
            <div class="main-subrow keyValue ">
              <div class=""><span class="inline-flex">
                  <div><a href="read-states.html"><span>read</span><wbr></wbr><span><span>States</span></span></a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-2102066566%2FFunctions%2F332232451"></span>
                    <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                  </span></span></div>
              <div>
                <div class="title">
                  <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":server/main"><div class="symbol monospace"><span class="token keyword">protected </span><span class="token keyword">open </span><span class="token keyword">fun </span><a href="read-states.html"><span class="token function">readStates</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">format<span class="token operator">: </span><span data-unresolved-link="io.spine.client/ResponseFormat///PointingToDeclaration/">ResponseFormat</span></span></span><span class="token punctuation">)</span><span class="token operator">: </span><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Iterator.html">Iterator</a><span class="token operator">&lt;</span><a href="../../io.spine.server.entity/-entity-record/index.html">EntityRecord</a><span class="token operator">&gt;</span></div><div class="brief ">Reads the aggregate states from the storage and returns the results in the specified format.</div><div class="symbol monospace"><span class="token keyword">protected </span><span class="token keyword">open </span><span class="token keyword">fun </span><a href="read-states.html"><span class="token function">readStates</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">query<span class="token operator">: </span><span data-unresolved-link="io.spine.query/EntityQuery///PointingToDeclaration/">EntityQuery</span><span class="token operator">&lt;</span><a href="index.html">I</a><span class="token punctuation">, </span><a href="index.html">S</a><span class="token punctuation">, </span><span class="token keyword">out </span><a href="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin/-any/index.html">Any</a><span class="token operator">&gt;</span></span></span><span class="token punctuation">)</span><span class="token operator">: </span><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Iterator.html">Iterator</a><span class="token operator">&lt;</span><a href="../../io.spine.server.entity/-entity-record/index.html">EntityRecord</a><span class="token operator">&gt;</span></div><div class="brief ">Reads the aggregate states from the storage according to the specified query.</div><div class="symbol monospace"><span class="token keyword">protected </span><span class="token keyword">open </span><span class="token keyword">fun </span><a href="read-states.html"><span class="token function">readStates</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">filters<span class="token operator">: </span><span data-unresolved-link="io.spine.client/TargetFilters///PointingToDeclaration/">TargetFilters</span><span class="token punctuation">, </span></span><span class="parameter ">format<span class="token operator">: </span><span data-unresolved-link="io.spine.client/ResponseFormat///PointingToDeclaration/">ResponseFormat</span></span></span><span class="token punctuation">)</span><span class="token operator">: </span><a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/util/Iterator.html">Iterator</a><span class="token operator">&lt;</span><a href="../../io.spine.server.entity/-entity-record/index.html">EntityRecord</a><span class="token operator">&gt;</span></div><div class="brief ">Queries the storage for the Aggregate states according to the passed filters and returns the results in the specified response format.</div></div></div>
                </div>
              </div>
            </div>
          </div>
<a data-name="-1833232749%2FFunctions%2F332232451" anchor-label="write" id="-1833232749%2FFunctions%2F332232451" data-filterable-set=":server/main"></a>
          <div class="table-row table-row_content" data-filterable-current=":server/main" data-filterable-set=":server/main">
            <div class="main-subrow keyValue ">
              <div class=""><span class="inline-flex">
                  <div><a href="write.html"><span><span>write</span></span></a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-1833232749%2FFunctions%2F332232451"></span>
                    <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                  </span></span></div>
              <div>
                <div class="title">
                  <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":server/main"><div class="symbol monospace"><span class="token keyword">open </span><span class="token keyword">fun </span><a href="write.html"><span class="token function">write</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">id<span class="token operator">: </span><a href="index.html">I</a><span class="token punctuation">, </span></span><span class="parameter ">events<span class="token operator">: </span><a href="../-aggregate-history/index.html">AggregateHistory</a></span></span><span class="token punctuation">)</span></div><div class="brief ">Writes events into the storage.</div></div></div>
                </div>
              </div>
            </div>
          </div>
<a data-name="-660642951%2FFunctions%2F332232451" anchor-label="writeAll" id="-660642951%2FFunctions%2F332232451" data-filterable-set=":server/main"></a>
          <div class="table-row table-row_content" data-filterable-current=":server/main" data-filterable-set=":server/main">
            <div class="main-subrow keyValue ">
              <div class=""><span class="inline-flex">
                  <div><a href="write-all.html"><span>write</span><wbr></wbr><span><span>All</span></span></a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-660642951%2FFunctions%2F332232451"></span>
                    <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                  </span></span></div>
              <div>
                <div class="title">
                  <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":server/main"><div class="symbol monospace"><span class="token keyword">protected </span><span class="token keyword">open </span><span class="token keyword">fun </span><a href="write-all.html"><span class="token function">writeAll</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">aggregate<span class="token operator">: </span><a href="../-aggregate/index.html">Aggregate</a><span class="token operator">&lt;</span><a href="index.html">I</a><span class="token punctuation">, </span><span class="token keyword">out </span><a href="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin/-any/index.html">Any</a><span class="token punctuation">, </span><span class="token keyword">out </span><a href="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin/-any/index.html">Any</a><span class="token operator">&gt;</span><span class="token punctuation">, </span></span><span class="parameter ">historySegments<span class="token operator">: </span><span data-unresolved-link="com.google.common.collect/ImmutableList///PointingToDeclaration/">ImmutableList</span><span class="token operator">&lt;</span><a href="../-aggregate-history/index.html">AggregateHistory</a><span class="token operator">&gt;</span></span></span><span class="token punctuation">)</span></div></div></div>
                </div>
              </div>
            </div>
          </div>
<a data-name="-1308073063%2FFunctions%2F332232451" anchor-label="writeEventRecord" id="-1308073063%2FFunctions%2F332232451" data-filterable-set=":server/main"></a>
          <div class="table-row table-row_content" data-filterable-current=":server/main" data-filterable-set=":server/main">
            <div class="main-subrow keyValue ">
              <div class=""><span class="inline-flex">
                  <div><a href="write-event-record.html"><span>write</span><wbr></wbr><span>Event</span><wbr></wbr><span><span>Record</span></span></a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-1308073063%2FFunctions%2F332232451"></span>
                    <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                  </span></span></div>
              <div>
                <div class="title">
                  <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":server/main"><div class="symbol monospace"><span class="token keyword">protected </span><span class="token keyword">open </span><span class="token keyword">fun </span><a href="write-event-record.html"><span class="token function">writeEventRecord</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">id<span class="token operator">: </span><a href="index.html">I</a><span class="token punctuation">, </span></span><span class="parameter ">record<span class="token operator">: </span><a href="../-aggregate-event-record/index.html">AggregateEventRecord</a></span></span><span class="token punctuation">)</span></div><div class="brief ">Writes the passed record into the storage.</div></div></div>
                </div>
              </div>
            </div>
          </div>
<a data-name="-743616371%2FFunctions%2F332232451" anchor-label="writeState" id="-743616371%2FFunctions%2F332232451" data-filterable-set=":server/main"></a>
          <div class="table-row table-row_content" data-filterable-current=":server/main" data-filterable-set=":server/main">
            <div class="main-subrow keyValue ">
              <div class=""><span class="inline-flex">
                  <div><a href="write-state.html"><span>write</span><wbr></wbr><span><span>State</span></span></a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-743616371%2FFunctions%2F332232451"></span>
                    <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                  </span></span></div>
              <div>
                <div class="title">
                  <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":server/main"><div class="symbol monospace"><span class="token keyword">protected </span><span class="token keyword">open </span><span class="token keyword">fun </span><a href="write-state.html"><span class="token function">writeState</span></a><span class="token punctuation">(</span><span class="parameters "><span class="parameter ">aggregate<span class="token operator">: </span><a href="../-aggregate/index.html">Aggregate</a><span class="token operator">&lt;</span><a href="index.html">I</a><span class="token punctuation">, </span><span class="token keyword">out </span><a href="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin/-any/index.html">Any</a><span class="token punctuation">, </span><span class="token keyword">out </span><a href="https://kotlinlang.org/api/core/kotlin-stdlib/kotlin/-any/index.html">Any</a><span class="token operator">&gt;</span></span></span><span class="token punctuation">)</span></div></div></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
    <div class="footer">
        <div class="footer--container">
            <a href="#content" id="go-to-top-link" class="footer--button footer--button_go-to-top"></a>
            <div class="footer--content">
                <div>
                    <span>Generated by </span>
                    <a class="footer--link footer--link_external" href="https://github.com/Kotlin/dokka">
                        Dokka
                    </a>
                    <div>Copyright 2025, TeamDev</div>
                </div>
            </div>
        </div>
    </div>
        </div>
    </div>
</div>
</body>
</html>